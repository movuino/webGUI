<!doctype html>
<html>
  <head>
    
   <script type="text/javascript" src="/js/smoothie.js"></script>
    <script type="text/javascript">
	
	var ax;
	var ay;
	var az;
	
	function splitString(stringToSplit, separator) {
		var arrayOfStrings = stringToSplit.split(separator);
		//for (var i=0; i < arrayOfStrings.length; i++)
		//print(arrayOfStrings[i] + " / ");
        var b = document.getElementById('example');
		ax = arrayOfStrings[1];
		ay = arrayOfStrings[2];
		az = arrayOfStrings[3];
		b.innerHTML = "<p> ax = " + ax + " , ay = " + ay + " , az = " + az + "</p>";		
		}	
		

    function startSockets() {
		websock = new WebSocket('ws://' + window.location.hostname + ':81/');
		websock.onopen = function(evt) { console.log('websock open'); };
		websock.onclose = function(evt) { console.log('websock close'); };
	//	websock.onmessage = function(evt) {console.log(evt);};
		websock.onerror = function(evt) { console.log(evt); };
		websock.onmessage = function(evt) {
		var dataAccel = evt.data
		var espace = " ";
		splitString(dataAccel, espace);

		console.log(evt);

		};  
		}

		
	
		
	  // Randomly add a data point every 500ms
      var random = new TimeSeries();
	  Serieax = new TimeSeries();
	  Serieay = new TimeSeries();
	  Serieaz = new TimeSeries();
	  
      setInterval(function() {
		// Call a function repetatively with 5 Second interval
		getData();
		websock.send("requestIMU");
		}, 500); //5000mSeconds update rate
      
      function createTimeline() {
		startSockets();
        var chart = new SmoothieChart();
        chart.addTimeSeries(random, { strokeStyle: 'rgba(255, 255, 255, 1)', fillStyle: 'rgba(0, 0, 0, 0.2)', lineWidth: 2 });
		chart.addTimeSeries(Serieax, { strokeStyle: 'rgba(255, 0, 0, 1)', fillStyle: 'rgba(255, 0, 0, 0.2)', lineWidth: 2 });
		chart.addTimeSeries(Serieay, { strokeStyle: 'rgba(0, 255, 0, 1)', fillStyle: 'rgba(0, 255, 0, 0.2)', lineWidth: 2 });
		chart.addTimeSeries(Serieaz, { strokeStyle: 'rgba(0, 0, 255, 1)', fillStyle: 'rgba(0, 0, 255, 0.2)', lineWidth: 2 });
        chart.streamTo(document.getElementById("chart"), 500);
      }
	  function getData() {
		
		var xhttp = new XMLHttpRequest();
	    xhttp.onreadystatechange = function() {
		if (this.readyState == 4 && this.status == 200) {
     //Push the data in array
	//var time = new Date().toLocaleTimeString();
	var ADCValue = this.responseText;
	 // values.push(ADCValue);
		random.append(new Date().getTime(),ADCValue);
		Serieax.append(new Date().getTime(),ax);
		Serieay.append(new Date().getTime(),ay);
		Serieaz.append(new Date().getTime(),az);
	  
      //timeStamp.push(time);
      //showGraph();	//Update Graphs
	//Update Data Table
	 // var table = document.getElementById("dataTable");
	 // var row = table.insertRow(1);	//Add after headings
	  //var cell1 = row.insertCell(0);
	  //var cell2 = row.insertCell(1);
	  //cell1.innerHTML = time;
	  //cell2.innerHTML = ADCValue;
    }
  };
  xhttp.open("GET", "readADC", true);	//Handle readADC server on ESP8266
  xhttp.send();
}
    </script>
  </head>
  <body onload="createTimeline();javascript:start();">

    <p>The <em>hello world</em> of <a href="../">Smoothie Charts</a>. View source.</p>

    <canvas id="chart" width="400" height="100"></canvas>
	
	<p> <span id="example"></span></p>
	

  </body>
</html>